<VirtualHost *:80>
    # ================================
    # Moonlit Detailing - Apache Configuration
    # ================================

    ServerAdmin admin@moonlit.local
    ServerName localhost
    ServerAlias moonlit.local www.moonlit.local

    # Document Root
    DocumentRoot /var/www/html

    <Directory /var/www/html>
        Options -Indexes +FollowSymLinks
        AllowOverride All
        Require all granted

        # Enable .htaccess files
        <IfModule mod_rewrite.c>
            RewriteEngine On
        </IfModule>
    </Directory>

    # Prevent access to src directory from web
    <Directory /var/www/src>
        Require all denied
    </Directory>

    # Allow access to uploads directory
    <Directory /var/www/html/uploads>
        Options -Indexes
        AllowOverride None
        Require all granted

        # Only allow specific file types
        <FilesMatch "\.(jpg|jpeg|png|gif|pdf)$">
            Require all granted
        </FilesMatch>
    </Directory>

    # Security Headers
    <IfModule mod_headers.c>
        Header set X-Content-Type-Options "nosniff"
        Header set X-Frame-Options "SAMEORIGIN"
        Header set X-XSS-Protection "1; mode=block"
        Header set Referrer-Policy "strict-origin-when-cross-origin"
    </IfModule>

    # Logging
    ErrorLog ${APACHE_LOG_DIR}/moonlit_error.log
    CustomLog ${APACHE_LOG_DIR}/moonlit_access.log combined

    # PHP Settings via Apache
    <IfModule mod_php.c>
        php_value upload_max_filesize 20M
        php_value post_max_size 20M
        php_value memory_limit 256M
        php_value max_execution_time 300
    </IfModule>

</VirtualHost>

# vim: syntax=apache ts=4 sw=4 sts=4 sr noet

